package ex54;
import java.awt.*;
import java.applet.*;
import java.util.*;

public class DigitalClock extends Applet implements Runnable
{
	protected Thread clockThread = null;
	protected Font font = null;
	protected Color color = null;
	protected Font dateFont = null;
	protected Color borderColor = null;

	String[] monthName = {"Jan", "Feb",
			"Mar", "Apr", "May", "Jun", "Jul",
			"Aug", "Sep", "Oct", "Nov",
			"Dec"};

	String[] dayName = {"Sun", "Mon", "Tue",
			"Wed", "Thu", "Fri", "Sat"};
	
	public void init()
	{	
		String fontName = findOrDefaultParamenter("FONT");
		font = new Font(fontName, Font.BOLD, 40);
		color = getColor("COLOR");
		dateFont = new Font(fontName, Font.BOLD, 40);
	}
	public void start()
	{
		if(clockThread == null){
			clockThread = new Thread(this);
			clockThread.start();
		}
	}
	
	public void stop()
	{
		clockThread = null;
	}
	
	public void run(){
		while(Thread.currentThread() == clockThread){			
			repaint();			
			try{
				Thread.currentThread();
				Thread.sleep(1000);
			}catch (InterruptedException e) {
				// TODO: handle exception
			}
		}
	}
	
	public void paint(Graphics g){
		Calendar calendar = Calendar.getInstance();
		int hour = calendar.get(Calendar.HOUR);
		int minute = calendar.get(Calendar.MINUTE);
		int second = calendar.get(Calendar.SECOND);
		int day = calendar.get(Calendar.DAY_OF_MONTH);
		int month = calendar.get(Calendar.MONTH);
		int year = calendar.get(Calendar.YEAR );
		int amPm = calendar.get(Calendar.AM_PM);
		int dayOfWeek = calendar.get(Calendar.DAY_OF_WEEK);
		String amPmStr = (amPm == Calendar.AM) ? "AM" : "PM";
		
		g.draw3DRect(2, 10, 240, 50, true);
		g.setFont(font);
		g.setColor(color);
		g.drawString(hour + ":" + minute + ":" + second + amPmStr, 10, 50);
		
		g.setColor(Color.BLACK);
		g.draw3DRect(2, 65, 240, 30, true);
		g.setFont(dateFont);
		g.setColor(color);
		g.drawString(day + " " + monthName[month] + " " + year + " " + dayName[dayOfWeek-1] , 10, 90);
	}
	
	private String findOrDefaultParamenter(String paramName){
		String param = getParameter(paramName);
		return param;
	}
	
	private String defaultParam(String paramName){

		if(paramName.equalsIgnoreCase("FONT"))
			return getParameter(paramName);
		if(paramName.equalsIgnoreCase("COLOR"))
		{
			String color = getParameter(paramName);
			if(!color.isEmpty()){
				String[] rgb = color.split(",");	
				int r = getColorComponent(rgb[0]);
				int g = getColorComponent(rgb[1]);
				int b = getColorComponent(rgb[2]);
				return new Color(r, g, b).toString();
			}else{
				return Color.BLACK.toString();
			}
		}
		return "FNT";
	}
	
	private Color getColor(){
		String color = getParameter("COLOR");
		if(!color.isEmpty()){
			String[] rgb = color.split(",");	
			int r = getColorComponent(rgb[0]);
			int g = getColorComponent(rgb[1]);
			int b = getColorComponent(rgb[2]);
			return new Color(r, g, b);
		}else{
			return Color.BLACK;
		}		
	}
	
	private int getColorComponent(String componentStr){
		return 1;
	}
}
